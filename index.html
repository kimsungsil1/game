<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score');

    let bird = {
        x: 50,
        y: 150,
        width: 20,
        height: 20,
        gravity: 0.3,
        lift: -10,
        velocity: 0
    };

    let pipes = [];
    let frameCount = 0;
    const pipeWidth = 40;
    const gapHeight = 150;
    let isGameOver = false;
    let score = 0;

    function drawBird() {
        ctx.fillStyle = '#FF4500';
        ctx.beginPath();
        ctx.arc(bird.x + bird.width / 2, bird.y + bird.height / 2, bird.width / 2, 0, Math.PI * 2);
        ctx.fill();
    }

    function drawPipes() {
        ctx.fillStyle = '#006400';
        pipes.forEach(pipe => {
            ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
            ctx.fillRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);
        });
    }

    function updateBird() {
        bird.velocity += bird.gravity;
        bird.y += bird.velocity;

        if (bird.y + bird.height >= canvas.height) {
            bird.y = canvas.height - bird.height;
            bird.velocity = 0;
            gameOver();
        }
        if (bird.y <= 0) {
            bird.y = 0;
            bird.velocity = 0;
        }
    }

    function updatePipes() {
        if (frameCount % 120 === 0) {
            let topHeight = Math.random() * (canvas.height / 2);
            let bottomHeight = topHeight + gapHeight;
            pipes.push({
                x: canvas.width,
                top: topHeight,
                bottom: bottomHeight
            });
        }

        pipes.forEach(pipe => {
            pipe.x -= 2;
            if (pipe.x + pipeWidth < 0) {
                pipes.shift();
                score++;
                scoreElement.textContent = 'Score: ' + score;
            }
            if (
                bird.x < pipe.x + pipeWidth &&
                bird.x + bird.width > pipe.x &&
                (bird.y < pipe.top || bird.y + bird.height > pipe.bottom)
            ) {
                gameOver();
            }
        });
    }

    function gameOver() {
        if (!isGameOver) {
            isGameOver = true;
            setTimeout(() => {
                alert('게임 오버! 최종 점수: ' + score);
                document.location.reload();
            }, 100);
        }
    }

    function gameLoop() {
        if (!isGameOver) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBird();
            drawPipes();
            updateBird();
            updatePipes();
            frameCount++;
            requestAnimationFrame(gameLoop);
        }
    }

    // 키보드 또는 터치 이벤트로 새를 띄움
    document.addEventListener('keydown', () => {
        bird.velocity = bird.lift;
    });

    // 터치 이벤트 추가
    document.addEventListener('touchstart', () => {
        bird.velocity = bird.lift;
    });

    gameLoop();
</script>
